# Phase 7: Excelフォーマット対応

## 概要

社内で使用しているExcelテンプレートに合わせた出力機能を実装する。

## ステータス: 未着手（後日対応）

## 前提条件
- Phase 1 〜 6 完了済み
- 社内Excelテンプレートの共有

---

## タスク一覧

### 7.1 テンプレート分析
- [ ] 社内テンプレートファイルの取得
- [ ] セル配置の確認
- [ ] 必要項目のマッピング

### 7.2 セルマッピング設定
- [ ] 設定ファイルまたはUI作成
- [ ] 各項目とセル位置の対応定義

```javascript
// 例: セルマッピング設定
const CELL_MAPPING = {
  year: "A1",
  month: "D1",
  employeeId: "A3",
  employeeName: "G3",
  department: "L3",

  // 日別データ（開始行から）
  dataStartRow: 13,
  columns: {
    date: "A",
    dayOfWeek: "C",
    kubun: "E",
    startTime: "I",
    endTime: "L",
    furikae: "AG"
  },

  // 集計
  summary: {
    workDays: "B7",
    holidayDays: "F7",
    paidLeaveDays: "P7",
    totalTime: "B9"
  }
};
```

### 7.3 テンプレート読み込み機能
- [ ] ユーザーがテンプレートファイルをアップロード
- [ ] テンプレートの検証
- [ ] テンプレートの保存（LocalStorage または Firestore）

### 7.4 データ埋め込み機能
- [ ] utils/excelExport.js の更新
- [ ] テンプレートへのデータ書き込み
- [ ] 書式の保持
- [ ] 数式の保持

### 7.5 出力機能
- [ ] 社員ごとの個別出力
- [ ] 複数社員の一括出力（管理者向け）
- [ ] ファイル名規則の設定

### 7.6 UI更新
- [ ] テンプレートアップロードUI
- [ ] セルマッピング設定UI（任意）
- [ ] プレビュー機能（任意）

---

## 技術的考慮事項

### xlsx ライブラリの制限
- 複雑な書式の一部が失われる可能性
- マクロは保持されない
- 必要に応じて ExcelJS への移行を検討

### 代替アプローチ
1. **xlsx ライブラリ**: 現在使用中、基本的な操作に対応
2. **ExcelJS**: より高機能、書式保持に優れる
3. **サーバーサイド処理**: Cloud Functions で処理する方法

---

## 実装記録

### 実装日:

### 実装内容:

（作業完了後に記載）

---

## 変更ファイル一覧

| ファイル | 変更種別 | 説明 |
|----------|----------|------|
| | | |

---

## 備考

- 社内テンプレートが共有され次第、詳細を追記
- セル位置は実際のテンプレートを見て調整
